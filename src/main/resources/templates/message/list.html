<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>쪽지 목록</title>
</head>
<body>
<h1>받은 쪽지 목록</h1>

<div th:if="${#lists.isEmpty(messages)}">
    <button type="submit">삭제</button>
    <table border="1">
        <thead>
        <tr>
            <th>
                <input type="checkbox" id="select" onclick="toggleSelectAll()" />
            </th>
            <th>번호</th>
            <th>보낸사람</th>
            <th>제목</th>
            <th>날짜</th>
            <th>읽음 여부</th>
        </tr>
        </thead>
    </table>
    <p>쪽지 목록이 없습니다.</p>
</div>

<div th:unless="${#lists.isEmpty(messages)}">
    <form method="post" th:action="@{/message/delete}" onsubmit="return validateForm()">
        <button type="submit">삭제</button>
        <table border="1">
            <thead>
            <tr>
                <th>
                    <input type="checkbox" id="selectAll" onclick="toggleSelectAll()" />
                </th>
                <th>번호</th>
                <th>보낸사람</th>
                <th>제목</th>
<!--                <th>내용</th>-->
                <th>날짜</th>
                <th>읽음 여부</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="message, iterStat : ${messages}">
                <td>
                    <input type="checkbox" name="messageIds" th:value="${message.id}" class="messageCheckbox"/>
                </td>
<!--                <td><a th:href="@{/message/view?messageId={id}(id=${message.id})}" th:text="${iterStat.index + 1}"></a></td>-->
                <td><a th:href="@{/message/view(messageId=${message.id})}" th:text="${iterStat.index + 1}"></a></td>
                <td th:text="${message.senderId}"></td>
                <td><a th:href="@{/message/view?messageId={id}(id=${message.id})}" th:text="${message.title}"></a></td>
<!--                <td th:text="${message.title}"></td>-->
<!--                <td th:text="${message.content}"></td>-->
<!--                <td th:text="${message.regDate}"></td>-->
                <td th:text="${#temporals.format(message.regDate, 'yyyy-MM-dd HH:mm')}"></td>
                <td th:text="${message.isRead ? '읽음' : '안 읽음'}"></td>
            </tr>
            </tbody>
        </table>
    </form>
</div>
<button type="button" onclick="window.location.href='/message/send/list';">보낸쪽지목록</button>
<button type="submit" onclick="window.location.href='/message/regist';">쪽지 쓰기</button>

<script>
    function toggleSelectAll() {
        const selectAllCheckbox = document.getElementById('selectAll');
        const checkboxes = document.querySelectorAll('.messageCheckbox');
        checkboxes.forEach(checkbox => {
            checkbox.checked = selectAllCheckbox.checked;
        });
    }

    function validateForm(){
        const selectMessages = document.querySelector('.messageCheckbox:checked');
        if(selectMessages.length === 0){
            alert('삭제할 쪽지를 선택해주세요.');
            return false;
        }
        return true;
    }
</script>
</body>
</html>