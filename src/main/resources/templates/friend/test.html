<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>친구 관리</title>
    <meta charset="UTF-8">
    <style>
        /* 기본 스타일 */
        .section {
            margin-bottom: 30px;
        }
        .section h3 {
            margin-bottom: 10px;
        }
        .friend-list, .search-results, .friend-requests {
            list-style: none;
            padding: 0;
        }
        .friend-list li, .search-results li, .friend-requests li {
            margin-bottom: 5px;
        }
        .button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
<h1>친구 관리</h1>

<!-- 친구 검색 섹션 -->
<div class="section">
    <h3>친구 검색</h3>
    <form th:action="@{/friend/manage}" method="get">
        <input type="text" name="keyword" placeholder="아이디 또는 이름 검색" th:value="${keyword}" />
        <button type="submit">검색</button>
    </form>

    <ul class="search-results">
        <li th:each="member : ${searchResults}">
            <span th:text="${member.name} + ' (' + ${member.memberId} + ')'"></span>
            <form th:action="@{/friend/request}" method="post" style="display:inline;">
                <input type="hidden" name="receiver" th:value="${member.memberId}" />
                <button type="submit" class="button">친구 신청</button>
            </form>
        </li>
    </ul>

    <!-- 더보기 버튼 -->
    <div th:if="${searchResults.size()} == ${pageSize}">
        <form th:action="@{/friend/manage}" method="get">
            <input type="hidden" name="keyword" th:value="${keyword}" />
            <input type="hidden" name="page" th:value="${page + 1}" />
            <input type="hidden" name="size" th:value="${pageSize}" />
            <button type="submit">더보기</button>
        </form>
    </div>
</div>

<!-- 친구 요청 섹션 -->
<div class="section">
    <h3>받은 친구 요청</h3>
    <ul class="friend-requests">
        <li th:each="request : ${friendRequests}">
            <span th:text="${request.requesterName} + ' (' + ${request.requester} + ')'"></span>
            <form th:action="@{'/friend/accept/' + ${request.friendId}}" method="post" style="display:inline;">
                <button type="submit" class="button">수락</button>
            </form>
            <form th:action="@{'/friend/reject/' + ${request.friendId}}" method="post" style="display:inline;">
                <button type="submit" class="button">거절</button>
            </form>
        </li>
    </ul>
</div>

<!-- 친구 목록 섹션 -->
<div class="section">
    <h3>친구 목록</h3>
    <ul class="friend-list">
        <li th:each="friend : ${friends}">
                <span th:text="${friend.requesterName != null ? friend.requesterName : friend.receiverName} + ' (' +
                             (${friend.requesterName != null ? friend.requester : friend.receiver}) + ')'"></span>
            <form th:action="@{'/friend/delete/' + ${friend.friendId}}" method="post" style="display:inline;">
                <button type="submit" class="button">삭제</button>
            </form>
        </li>
    </ul>
</div>
</body>
</html>